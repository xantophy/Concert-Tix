<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/Concert/assets/images/logo_1.png" type="image/x-icon" />
    <title>Sign Up | ConcertTix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
      :root {
        --primary-purple: #8a4fff;
        --primary-orange: #ff6600;
        --gradient-purple: linear-gradient(135deg, #8a4fff 0%, #5e2de0 100%);
        --gradient-orange: linear-gradient(135deg, #ff6600 0%, #ff944d 100%);
      }

      body {
        background: linear-gradient(to right, #f5f0ff 0%, #ffffff 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        overflow-x: hidden;
      }

      .signup-container {
        max-width: 900px;
        margin: 0 auto;
        padding-top: 40px;
      }

      .signup-card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 15px 40px rgba(138, 79, 255, 0.2);
        overflow: hidden;
        display: flex;
        min-height: 600px;
      }

      .signup-header {
        background: var(--gradient-purple);
        color: white;
        padding: 40px;
        width: 40%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }

      .signup-header::before {
        content: "";
        position: absolute;
        top: -50px;
        right: -50px;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
      }

      .signup-header::after {
        content: "";
        position: absolute;
        bottom: -80px;
        left: -80px;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.05);
      }

      .signup-body {
        padding: 40px;
        background: white;
        width: 60%;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .form-control:focus {
        border-color: var(--primary-purple);
        box-shadow: 0 0 0 0.2rem rgba(138, 79, 255, 0.1);
      }

      .btn-purple {
        background: var(--gradient-purple);
        border: none;
        color: white;
        padding: 12px;
        font-weight: 500;
        transition: all 0.3s ease;
        border-radius: 8px;
      }

      .btn-purple:hover {
        background: linear-gradient(135deg, #7a3fef 0%, #4e1dd0 100%);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(138, 79, 255, 0.3);
      }

      .brand-logo {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 20px;
        display: inline-block;
        z-index: 2;
      }

      .brand-logo span:first-child {
        color: white;
      }

      .brand-logo span:last-child {
        color: var(--primary-orange);
      }

      .header-content {
        z-index: 2;
      }

      .header-content h4 {
        font-weight: 300;
        margin-bottom: 30px;
      }

      .header-content p {
        opacity: 0.9;
        font-weight: 300;
        margin-bottom: 30px;
      }

      .gradient-text {
        background: linear-gradient(90deg, #8a4fff, #ff6600);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        display: inline;
      }

      .header-content {
        position: relative;
        z-index: 2;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      #accountSection {
        display: block;
      }

      .genre-selection.active ~ #accountSection,
      .genre-selection.active + #accountSection {
        display: none;
      }

      .music-icon {
        font-size: 1.8rem;
        margin-right: 10px;
        vertical-align: middle;
      }

      .floating-element {
        position: absolute;
        color: rgba(255, 255, 255, 0.8);
        font-size: 2rem;
        opacity: 0.6;
        animation: float 6s infinite ease-in-out;
        z-index: 1;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(10deg);
        }
      }

      /* Genre selection styles */
      .genre-selection {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .genre-options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 20px;
      }

      .genre-option {
        position: relative;
      }

      .genre-option input {
        position: absolute;
        opacity: 0;
        height: 0;
        width: 0;
      }

      .genre-option label {
        display: block;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .genre-option input:checked + label {
        border-color: var(--primary-purple);
        background: rgba(138, 79, 255, 0.1);
        color: var(--primary-purple);
        font-weight: 500;
      }

      .genre-option label:hover {
        border-color: var(--primary-purple);
      }

      .progress-steps {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
        position: relative;
      }

      .progress-steps::before {
        content: "";
        position: absolute;
        top: 15px;
        left: 0;
        right: 0;
        height: 2px;
        background: #eee;
        z-index: 1;
      }

      .progress-step {
        position: relative;
        z-index: 2;
        text-align: center;
        width: 30px;
      }

      .progress-step-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #eee;
        color: #777;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 5px;
        font-weight: 500;
      }

      .progress-step.active .progress-step-number {
        background: var(--primary-purple);
        color: white;
      }

      .progress-step.complete .progress-step-number {
        background: var(--primary-purple);
        color: white;
      }

      .progress-step.complete .progress-step-number::after {
        content: "\2713";
      }

      .progress-step-label {
        font-size: 0.8rem;
        color: #777;
      }

      .progress-step.active .progress-step-label {
        color: var(--primary-purple);
        font-weight: 500;
      }

      .btn-skip {
        background: transparent;
        border: none;
        color: #777;
        text-decoration: underline;
        margin-top: 15px;
        display: block;
        width: 100%;
        transition: color 0.3s;
      }

      .btn-skip:hover {
        color: var(--primary-purple);
      }

      .signup-footer {
        text-align: center;
        margin-top: 30px;
        color: #666;
      }

      .signup-footer a {
        color: var(--primary-purple);
        text-decoration: none;
        font-weight: 500;
      }

      .signup-footer a:hover {
        text-decoration: underline;
      }

      .form-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--primary-purple);
      }

      .form-note {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 20px;
      }

      @media (max-width: 768px) {
        .signup-card {
          flex-direction: column;
        }

        .signup-header,
        .signup-body {
          width: 100%;
        }

        .signup-header {
          padding: 30px;
        }
      }

      /* Subtle Music Wave Animation */
      .music-waves {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        gap: 4px;
        padding: 0 20px;
        z-index: 1;
        opacity: 0.2;
        overflow: hidden;
      }

      .wave-column {
        position: relative;
        width: 6px;
        height: 100%;
      }

      .wave-segment {
        position: absolute;
        width: 100%;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 3px 3px 0 0;
        animation: waveRise 4s infinite ease-in-out;
        animation-fill-mode: both;
        bottom: 0;
        left: 0;
      }

      /* Random height and timing */
      .wave-column:nth-child(1) .wave-segment {
        height: 30%;
        animation-delay: 0.5s;
      }
      .wave-column:nth-child(2) .wave-segment {
        height: 50%;
        animation-delay: 1.2s;
      }
      .wave-column:nth-child(3) .wave-segment {
        height: 70%;
        animation-delay: 0.8s;
      }
      .wave-column:nth-child(4) .wave-segment {
        height: 40%;
        animation-delay: 1.5s;
      }
      .wave-column:nth-child(5) .wave-segment {
        height: 60%;
        animation-delay: 0.3s;
      }
      .wave-column:nth-child(6) .wave-segment {
        height: 80%;
        animation-delay: 2s;
      }
      .wave-column:nth-child(7) .wave-segment {
        height: 45%;
        animation-delay: 1s;
      }
      .wave-column:nth-child(8) .wave-segment {
        height: 65%;
        animation-delay: 0.7s;
      }
      .wave-column:nth-child(9) .wave-segment {
        height: 35%;
        animation-delay: 1.8s;
      }
      .wave-column:nth-child(10) .wave-segment {
        height: 55%;
        animation-delay: 0.2s;
      }

      @keyframes waveRise {
        0%,
        100% {
          transform: scaleY(0.1);
          opacity: 0.3;
        }
        50% {
          transform: scaleY(1);
          opacity: 0.7;
        }
      }

      /* Floating music notes */
      .music-note {
        position: absolute;
        color: rgba(255, 255, 255, 0.15);
        font-size: 1.8rem;
        animation: floatNote 12s infinite linear;
      }

      @keyframes floatNote {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 0.15;
        }
        90% {
          opacity: 0.15;
        }
        100% {
          transform: translateY(-100px) rotate(20deg);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="floating-element" style="top: 10%; left: 5%; animation-delay: 0s">♪</div>
    <div class="floating-element" style="top: 80%; left: 90%; animation-delay: 1s; color: #ff944d">♫</div>
    <div class="floating-element" style="top: 40%; left: 92%; animation-delay: 2s">♩</div>

    <div class="signup-container">
      <div class="signup-card">
        <div class="signup-header">
          <div class="music-waves">
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
          </div>

          <div class="music-note" style="left: 15%; animation-delay: 2s">♪</div>
          <div class="music-note" style="left: 30%; animation-delay: 5s">♫</div>
          <div class="music-note" style="left: 70%; animation-delay: 7s">♩</div>
          <div class="music-note" style="left: 85%; animation-delay: 3s">♬</div>
          <div class="floating-element" style="top: 20%; left: 60%">♬</div>
          <div class="floating-element" style="top: 70%; left: 20%">♫</div>
          <div class="header-content">
            <div class="brand-logo"><span>Concert</span><span>Tix</span></div>
            <h4>Join the Music Revolution</h4>
            <p><i class="bi bi-music-note-beamed music-icon"></i> Discover unforgettable live experiences</p>
            <p><i class="bi bi-ticket-perforated music-icon"></i> Get early access to exclusive tickets</p>
            <p><i class="bi bi-heart music-icon"></i> Personalized recommendations just for you</p>
          </div>
        </div>

        <div class="signup-body">
          <div class="progress-steps">
            <div class="progress-step active" id="step1-indicator">
              <div class="progress-step-number">1</div>
              <div class="progress-step-label">Account</div>
            </div>
            <div class="progress-step" id="step2-indicator">
              <div class="progress-step-number">2</div>
              <div class="progress-step-label">Preferences</div>
            </div>
          </div>

          <div id="accountSection">
            <div class="account-header">
              <h3 class="form-title"><span class="gradient-text">Create Your Account</span></h3>
              <p class="form-note">Join thousands of music lovers discovering amazing concerts</p>
            </div>

            <form id="accountForm" action="signup.php" method="post">
              <div class="mb-3">
                <label for="name" class="form-label">Full Name</label>
                <input type="text" class="form-control" name="name" id="name" required />
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email address</label>
                <input type="email" class="form-control" name="email" id="email" required />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" name="password" id="password" required />
              </div>
              <div class="mb-3">
                <label for="confirmPassword" class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="confirmPassword" required />
              </div>
              <div id="signupMessage" class="alert alert-danger d-none" role="alert"></div>
              <button type="submit" class="btn btn-purple w-100">Continue</button>
            </form>
          </div>

          <div class="genre-selection" id="genreSelection">
            <h3 class="form-title"><span class="gradient-text">Your Music Preferences</span></h3>
            <p class="form-note">Select your favorite genres to get personalized recommendations</p>

            <div class="genre-options" id="genreOptionsContainer">
              <div class="genre-option">
                <input type="checkbox" id="pop" name="genres[]" value="1" />
                <label for="pop">Pop</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="rock" name="genres[]" value="2" />
                <label for="rock">Rock</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="jazz" name="genres[]" value="3" />
                <label for="jazz">Jazz</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="classical" name="genres[]" value="4" />
                <label for="classical">Classical</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="hiphop" name="genres[]" value="5" />
                <label for="hiphop">Hip Hop</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="edm" name="genres[]" value="6" />
                <label for="edm">EDM</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="rnb" name="genres[]" value="7" />
                <label for="rnb">R&B</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="reggae" name="genres[]" value="8" />
                <label for="reggae">Reggae</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="kpop" name="genres[]" value="9" />
                <label for="kpop">K-Pop</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="dangdut" name="genres[]" value="10" />
                <label for="dangdut">Dangdut</label>
              </div>
              <div class="genre-option">
                <input type="checkbox" id="indie" name="genres[]" value="11" />
                <label for="indie">Indie</label>
              </div>
            </div>

            <button type="button" class="btn btn-purple w-100 mt-4" id="completeSignup">Complete Sign Up</button>
            <button type="button" class="btn-skip" id="skipGenre">Skip for now</button>
          </div>

          <div class="signup-footer">Already have an account? <a href="/Concert/auth/login.html">Login</a></div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        loadGenresToForm(); // Panggil fungsi untuk memuat genre saat DOM siap
      });

      function loadGenresToForm() {
        fetch("/Concert/auth/get_genres.php") // Path ke get_genres.php di folder auth/
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok: " + response.statusText);
            }
            return response.json();
          })
          .then((genres) => {
            const container = document.getElementById("genreOptionsContainer");
            if (container) {
              container.innerHTML = ""; // Bersihkan genre statis jika ada

              genres.forEach((genre) => {
                const div = document.createElement("div");
                div.className = "genre-option";
                // Pastikan value adalah GenreID dari database
                div.innerHTML = `
                  <input type="checkbox" id="genre-${genre.GenreID}" name="genres[]" value="${genre.GenreID}" />
                  <label for="genre-${genre.GenreID}">${genre.genre}</label>
                `;
                container.appendChild(div);
              });
            }
          })
          .catch((error) => {
            console.error("Error loading genres:", error);
            const genreSection = document.getElementById("genreSelection");
            if (genreSection) {
              const errorDiv = document.createElement("div");
              errorDiv.className = "alert alert-warning mt-3";
              errorDiv.textContent = "Failed to load genres. Please try again later. (Error: " + error.message + ")";
              genreSection.prepend(errorDiv);
            }
          });
      }

      document.getElementById("accountForm").addEventListener("submit", function (e) {
        e.preventDefault(); // PASTIKAN INI TIDAK DIKOMENTARI

        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const confirmPassword = document.getElementById("confirmPassword").value;
        const signupMessage = document.getElementById("signupMessage");

        signupMessage.classList.add("d-none");
        signupMessage.textContent = "";

        if (password !== confirmPassword) {
          signupMessage.textContent = "Passwords do not match!";
          signupMessage.classList.remove("d-none");
          return;
        }

        const audio = new Audio("/Concert/assets/audio/harp.wav");
        audio.volume = 0.3;
        audio.play();

        const formData = new FormData();
        formData.append("name", name);
        formData.append("email", email);
        formData.append("password", password);

        fetch("/Concert/auth/signup.php", {
          // Path ke signup.php yang sudah benar
          method: "POST",
          body: formData,
        })
          .then((response) => {
            if (!response.ok) {
              return response.text().then((text) => {
                throw new Error(`Server Error: ${text}`);
              });
            }
            return response.json(); // Harapkan respons JSON dari PHP
          })
          .then((data) => {
            if (data.status === "success") {
              // Akun berhasil dibuat, tampilkan bagian pemilihan genre
              document.getElementById("genreSelection").classList.add("active");
              document.getElementById("accountSection").style.display = "none";
              document.getElementById("genreSelection").style.display = "block";

              // Update progress steps
              document.getElementById("step1-indicator").classList.remove("active");
              document.getElementById("step1-indicator").classList.add("complete");
              document.getElementById("step2-indicator").classList.add("active");

              // Opsional: Anda bisa menyimpan UserID di localStorage jika perlu untuk pengiriman genre terpisah
              // localStorage.setItem('currentUserId', data.userId);
            } else {
              signupMessage.textContent = data.message;
              signupMessage.classList.remove("d-none");
              const errorAudio = new Audio("/Concert/assets/audio/error_sound.wav");
              if (errorAudio) {
                errorAudio.volume = 0.6;
                errorAudio.play();
              }
            }
          })
          .catch((error) => {
            console.error("Fetch error:", error);
            signupMessage.textContent = "An error occurred. Please try again: " + error.message;
            signupMessage.classList.remove("d-none");
          });
      });

      document.getElementById("completeSignup").addEventListener("click", function () {
        const audio = new Audio("/Concert/assets/audio/achievement.wav");
        audio.volume = 0.3;
        audio.play();

        const selectedGenreIDs = [];
        document.querySelectorAll('#genreOptionsContainer input[type="checkbox"]:checked').forEach((checkbox) => {
          selectedGenreIDs.push(checkbox.value);
        });

        // Buat FormData untuk mengirim genre
        const formDataGenres = new FormData();
        formDataGenres.append("action", "save_genres"); // Aksi untuk menyimpan genre
        selectedGenreIDs.forEach((id) => {
          formDataGenres.append("genres[]", id); // Kirim semua ID genre yang dipilih
        });

        fetch("/Concert/auth/signup.php", {
          // Kirim genre ke signup.php
          method: "POST",
          body: formDataGenres,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              // Genre berhasil disimpan, alihkan ke landing page
              setTimeout(() => {
                window.location.href = "/Concert/public/index.html"; // Atau index.php jika sudah diubah namanya
              }, 1500);
            } else {
              alert("Failed to save genres: " + data.message);
              // Jika genre gagal disimpan, tetap alihkan ke landing page setelah tunda
              setTimeout(() => {
                window.location.href = "/Concert/public/index.html";
              }, 1500);
            }
          })
          .catch((error) => {
            console.error("Error sending genres:", error);
            alert("An error occurred while saving genres: " + error.message);
            // Tetap alihkan meskipun ada error network
            setTimeout(() => {
              window.location.href = "/Concert/public/index.html";
            }, 1500);
          });
      });

      document.getElementById("skipGenre").addEventListener("click", function () {
        const audio = new Audio("/Concert/assets/audio/secret.wav");
        audio.volume = 0.3;
        audio.play();

        // Tidak perlu kirim genre jika di-skip, langsung alihkan
        setTimeout(() => {
          window.location.href = "/Concert/public/index.html"; // Atau index.php jika sudah diubah namanya
        }, 1150);
      });
    </script>
  </body>
</html>
