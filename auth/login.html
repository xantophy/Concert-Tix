<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="../assets/images/logo_1.png" type="image/x-icon" />
    <title>Login | ConcertTix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
      :root {
        --primary-purple: #8a4fff;
        --primary-orange: #ff6600;
        --gradient-purple: linear-gradient(135deg, #8a4fff 0%, #5e2de0 100%);
        --gradient-orange: linear-gradient(135deg, #ff6600 0%, #ff944d 100%);
      }

      body {
        background: linear-gradient(to right, #f5f0ff 0%, #ffffff 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        overflow-x: hidden;
      }

      .login-container {
        max-width: 900px;
        margin: 0 auto;
        padding-top: 40px;
      }

      .login-card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 15px 40px rgba(138, 79, 255, 0.2);
        overflow: hidden;
        display: flex;
        min-height: 600px;
      }

      .login-header {
        background: var(--gradient-purple);
        color: white;
        padding: 40px;
        width: 40%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }

      .login-header::before {
        content: "";
        position: absolute;
        top: -50px;
        right: -50px;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
      }

      .login-header::after {
        content: "";
        position: absolute;
        bottom: -80px;
        left: -80px;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.05);
      }

      .login-body {
        padding: 40px;
        background: white;
        width: 60%;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .form-control:focus {
        border-color: var(--primary-purple);
        box-shadow: 0 0 0 0.2rem rgba(138, 79, 255, 0.1);
      }

      .btn-purple {
        background: var(--gradient-purple);
        border: none;
        color: white;
        padding: 12px;
        font-weight: 500;
        transition: all 0.3s ease;
        border-radius: 8px;
      }

      .btn-purple:hover {
        background: linear-gradient(135deg, #7a3fef 0%, #4e1dd0 100%);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(138, 79, 255, 0.3);
      }

      .brand-logo {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 20px;
        display: inline-block;
        z-index: 2;
      }

      .brand-logo span:first-child {
        color: white;
      }

      .brand-logo span:last-child {
        color: var(--primary-orange);
      }

      .header-content {
        z-index: 2;
        position: relative;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .header-content h4 {
        font-weight: 300;
        margin-bottom: 30px;
      }

      .header-content p {
        opacity: 0.9;
        font-weight: 300;
        margin-bottom: 30px;
      }

      .gradient-text {
        background: linear-gradient(90deg, #8a4fff, #ff6600);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        display: inline;
      }

      .music-icon {
        font-size: 1.8rem;
        margin-right: 10px;
        vertical-align: middle;
      }

      .floating-element {
        position: absolute;
        color: rgba(255, 255, 255, 0.8);
        font-size: 2rem;
        opacity: 0.6;
        animation: float 6s infinite ease-in-out;
        z-index: 1;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(10deg);
        }
      }

      /* Music wave animation */
      .music-waves {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        gap: 4px;
        padding: 0 20px;
        z-index: 1;
        opacity: 0.2;
        overflow: hidden;
      }

      .wave-column {
        position: relative;
        width: 6px;
        height: 100%;
      }

      .wave-segment {
        position: absolute;
        width: 100%;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 3px 3px 0 0;
        animation: waveRise 4s infinite ease-in-out;
        animation-fill-mode: both;
        bottom: 0;
        left: 0;
      }

      /* Random height and timing */
      .wave-column:nth-child(1) .wave-segment {
        height: 30%;
        animation-delay: 0.5s;
      }
      .wave-column:nth-child(2) .wave-segment {
        height: 50%;
        animation-delay: 1.2s;
      }
      .wave-column:nth-child(3) .wave-segment {
        height: 70%;
        animation-delay: 0.8s;
      }
      .wave-column:nth-child(4) .wave-segment {
        height: 40%;
        animation-delay: 1.5s;
      }
      .wave-column:nth-child(5) .wave-segment {
        height: 60%;
        animation-delay: 0.3s;
      }
      .wave-column:nth-child(6) .wave-segment {
        height: 80%;
        animation-delay: 2s;
      }
      .wave-column:nth-child(7) .wave-segment {
        height: 45%;
        animation-delay: 1s;
      }
      .wave-column:nth-child(8) .wave-segment {
        height: 65%;
        animation-delay: 0.7s;
      }
      .wave-column:nth-child(9) .wave-segment {
        height: 35%;
        animation-delay: 1.8s;
      }
      .wave-column:nth-child(10) .wave-segment {
        height: 55%;
        animation-delay: 0.2s;
      }

      @keyframes waveRise {
        0%,
        100% {
          transform: scaleY(0.1);
          opacity: 0.3;
        }
        50% {
          transform: scaleY(1);
          opacity: 0.7;
        }
      }

      /* Floating music notes */
      .music-note {
        position: absolute;
        color: rgba(255, 255, 255, 0.15);
        font-size: 1.8rem;
        animation: floatNote 12s infinite linear;
      }

      @keyframes floatNote {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 0.15;
        }
        90% {
          opacity: 0.15;
        }
        100% {
          transform: translateY(-100px) rotate(20deg);
          opacity: 0;
        }
      }

      .form-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 20px;
      }

      .form-note {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 20px;
      }

      .login-footer {
        text-align: center;
        margin-top: 30px;
        color: #666;
      }

      .login-footer a {
        color: var(--primary-purple);
        text-decoration: none;
        font-weight: 500;
      }

      .login-footer a:hover {
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        .login-card {
          flex-direction: column;
        }

        .login-header,
        .login-body {
          width: 100%;
        }

        .login-header {
          padding: 30px;
        }
      }
    </style>
  </head>
  <body>
    <div class="floating-element" style="top: 10%; left: 5%; animation-delay: 0s">♪</div>
    <div class="floating-element" style="top: 80%; left: 90%; animation-delay: 1s; color: #ff944d">♫</div>
    <div class="floating-element" style="top: 40%; left: 92%; animation-delay: 2s">♩</div>

    <div class="login-container">
      <div class="login-card">
        <div class="login-header">
          <div class="music-waves">
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
            <div class="wave-column"><div class="wave-segment"></div></div>
          </div>

          <div class="music-note" style="left: 15%; animation-delay: 2s">♪</div>
          <div class="music-note" style="left: 30%; animation-delay: 5s">♫</div>
          <div class="music-note" style="left: 70%; animation-delay: 7s">♩</div>
          <div class="music-note" style="left: 85%; animation-delay: 3s">♬</div>
          <div class="floating-element" style="top: 20%; left: 60%">♬</div>
          <div class="floating-element" style="top: 70%; left: 20%">♫</div>
          <div class="header-content">
            <div class="brand-logo"><span>Concert</span><span>Tix</span></div>
            <h4>Welcome Back</h4>
            <p><i class="bi bi-music-note-beamed music-icon"></i> Continue your musical journey</p>
            <p><i class="bi bi-ticket-perforated music-icon"></i> Access your ticket collection</p>
            <p><i class="bi bi-heart music-icon"></i> Personalized recommendations await</p>
          </div>
        </div>

        <div class="login-body">
          <h3 class="form-title"><span class="gradient-text">Login to Your Account</span></h3>
          <p class="form-note">Enter your details to access your ConcertTix experience</p>

          <form id="loginForm" action="login.php" method="post">
            <div class="mb-3">
              <label for="loginEmail" class="form-label">Email address</label>
              <input type="email" class="form-control" name="email" id="loginEmail" required />
            </div>
            <div class="mb-3">
              <label for="loginPassword" class="form-label">Password</label>
              <input type="password" class="form-control" name="password" id="loginPassword" required />
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="rememberMe" />
              <label class="form-check-label" for="rememberMe">Remember me</label>
              <a href="../lost/404_page.html" class="float-end">Forgot password?</a>
            </div>
            <div id="loginMessage" class="alert alert-danger d-none" role="alert"></div>
            <button type="submit" class="btn btn-purple w-100">Login</button>
          </form>

          <div class="login-footer">Don't have an account? <a href="../auth/signup.html">Sign up</a></div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.getElementById("loginForm").addEventListener("submit", function (e) {
        e.preventDefault(); // Mencegah submit form tradisional

        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;
        const loginMessage = document.getElementById("loginMessage");

        // Sembunyikan pesan error sebelumnya
        loginMessage.classList.add("d-none");
        loginMessage.textContent = "";

        // Buat FormData object untuk mengirim data
        const formData = new FormData();
        formData.append("email", email);
        formData.append("password", password);

        fetch("login.php", {
          // Path relatif ke login.php di folder auth
          method: "POST",
          body: formData, // Kirim FormData
        })
          .then((response) => {
            if (!response.ok) {
              // Tangani respons non-OK (misalnya status 500)
              return response.text().then((text) => {
                throw new Error(`Server Error: ${text}`);
              });
            }
            return response.json(); // Harapkan respons JSON dari PHP
          })
          .then((data) => {
            if (data.status === "success") {
              // Login berhasil, alihkan pengguna
              const audio = new Audio("../assets/audio/choir.wav"); // Efek suara
              audio.volume = 0.6;
              audio.play();

              setTimeout(() => {
                // Redirect berdasarkan peran dari respons PHP
                if (data.role === "admin") {
                  window.location.href = "../admin/index.html"; // Path mutlak ke admin dashboard
                } else {
                  window.location.href = "../public/index.html"; // Path mutlak ke public landing page
                }
              }, 970);
            } else {
              // Login gagal, tampilkan pesan error dari server
              loginMessage.textContent = data.message;
              loginMessage.classList.remove("d-none");
              // Putar efek suara error jika ada (pastikan file audio ada)
              const audio = new Audio("../assets/audio/error_sound.wav");
              if (audio) {
                // Cek apakah audio objek berhasil dibuat
                audio.volume = 0.6;
                audio.play();
              }
            }
          })
          .catch((error) => {
            // Tangani error jaringan atau error lainnya
            console.error("Fetch error:", error);
            loginMessage.textContent = "An error occurred. Please try again later. " + error.message;
            loginMessage.classList.remove("d-none");
          });
      });
    </script>
  </body>
</html>
